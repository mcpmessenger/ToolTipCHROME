<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Check Extension Storage</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }
        .screenshot {
            max-width: 200px;
            max-height: 150px;
            border: 1px solid #ccc;
            margin: 10px;
        }
        button {
            background: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #005a87;
        }
        .error {
            color: #d32f2f;
            background: #ffebee;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            color: #2e7d32;
            background: #e8f5e8;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Extension Storage Checker</h1>
        
        <div class="section">
            <h2>Local Storage</h2>
            <button onclick="checkLocalStorage()">Check Local Storage</button>
            <div id="localStorageResults"></div>
        </div>
        
        <div class="section">
            <h2>IndexedDB Screenshots</h2>
            <button onclick="checkIndexedDB()">Check IndexedDB</button>
            <div id="indexedDBResults"></div>
        </div>
        
        <div class="section">
            <h2>Extension Status</h2>
            <button onclick="checkExtensionStatus()">Check Extension Status</button>
            <div id="extensionStatus"></div>
        </div>
    </div>

    <script>
        async function checkLocalStorage() {
            const results = document.getElementById('localStorageResults');
            results.innerHTML = '<p>Checking local storage...</p>';
            
            try {
                const settings = localStorage.getItem('tooltipSettings');
                if (settings) {
                    const parsed = JSON.parse(settings);
                    results.innerHTML = `
                        <div class="success">‚úÖ Local Storage Found</div>
                        <pre>${JSON.stringify(parsed, null, 2)}</pre>
                    `;
                } else {
                    results.innerHTML = '<div class="error">‚ùå No tooltipSettings found in local storage</div>';
                }
            } catch (error) {
                results.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }

        async function checkIndexedDB() {
            const results = document.getElementById('indexedDBResults');
            results.innerHTML = '<p>Checking IndexedDB...</p>';
            
            try {
                const dbName = 'ToolTipScreenshots';
                const request = indexedDB.open(dbName, 1);
                
                request.onsuccess = (event) => {
                    const db = event.target.result;
                    const transaction = db.transaction(['screenshots'], 'readonly');
                    const store = transaction.objectStore('screenshots');
                    const getAllRequest = store.getAll();
                    
                    getAllRequest.onsuccess = () => {
                        const screenshots = getAllRequest.result;
                        if (screenshots.length > 0) {
                            results.innerHTML = `
                                <div class="success">‚úÖ Found ${screenshots.length} screenshots in IndexedDB</div>
                                <div>
                                    ${screenshots.map((screenshot, index) => `
                                        <div style="margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                                            <h4>Screenshot ${index + 1}</h4>
                                            <p><strong>URL:</strong> ${screenshot.url}</p>
                                            <p><strong>Element Type:</strong> ${screenshot.elementType}</p>
                                            <p><strong>Timestamp:</strong> ${new Date(screenshot.timestamp).toLocaleString()}</p>
                                            <p><strong>Screenshot Size:</strong> ${screenshot.dataUrl ? screenshot.dataUrl.length : 0} characters</p>
                                            ${screenshot.dataUrl ? `<img src="${screenshot.dataUrl}" class="screenshot" alt="Screenshot">` : '<p>No image data</p>'}
                                        </div>
                                    `).join('')}
                                </div>
                            `;
                        } else {
                            results.innerHTML = '<div class="error">‚ùå No screenshots found in IndexedDB</div>';
                        }
                    };
                    
                    getAllRequest.onerror = () => {
                        results.innerHTML = '<div class="error">‚ùå Error reading IndexedDB</div>';
                    };
                };
                
                request.onerror = () => {
                    results.innerHTML = '<div class="error">‚ùå Could not open IndexedDB</div>';
                };
                
            } catch (error) {
                results.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }

        async function checkExtensionStatus() {
            const results = document.getElementById('extensionStatus');
            results.innerHTML = '<p>Checking extension status...</p>';
            
            try {
                if (typeof chrome !== 'undefined' && chrome.runtime && chrome.runtime.id) {
                    results.innerHTML = `
                        <div class="success">‚úÖ Extension is loaded</div>
                        <p><strong>Extension ID:</strong> ${chrome.runtime.id}</p>
                        <p><strong>Manifest Version:</strong> ${chrome.runtime.getManifest().manifest_version}</p>
                    `;
                } else {
                    results.innerHTML = '<div class="error">‚ùå Extension not detected</div>';
                }
            } catch (error) {
                results.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }

        // Auto-check on load
        window.addEventListener('load', () => {
            checkLocalStorage();
            checkIndexedDB();
            checkExtensionStatus();
        });
    </script>
</body>
</html>
